# 2026-02-27-1035-db-sql-files

## Objective
- Move SQLite schema/seed SQL out of `src-tauri/src/db/mod.rs` into standalone `.sql` migration files.
- Load SQL scripts from migration files during DB initialization.

## Scope
- Add migration SQL files under `src-tauri/src/db/migrations/`.
- Refactor `src-tauri/src/db/mod.rs` to execute file-loaded SQL scripts.
- Keep auth login and async route behavior unchanged.

## Checklist
- [x] Create task plan and timestamp timeline
- [x] Add failing test for SQL file loading
- [x] Add migration SQL files
- [x] Refactor db init to load scripts from files
- [x] Run verification (`cargo test --manifest-path src-tauri/Cargo.toml`)
- [x] Update docs/progress log

## Progress Timeline
- [10:35:33] Created task plan file and initialized scope/checklist (done)
- [10:36:01] Added RED test `loads_sql_scripts_from_files` in db module tests (done)
- [10:36:43] Ran RED test; failed with missing `schema_sql` and `seed_sql` functions as expected (done)
- [10:38:13] Added migration files `0001_schema.sql` and `0002_seed.sql` under `src-tauri/src/db/migrations` (done)
- [10:38:13] Refactored DB init to load SQL from migration files via `include_str!` (done)
- [10:40:12] Observed `rustc` ICE after rewrite; fixed by rewriting modified files with explicit UTF-8 encoding (done)
- [10:40:12] Fixed `set_database_path` race so concurrent first-set attempts in tests return `Ok(())` (done)
- [$now] Ran full `cargo test`; all tests passed (done)

## Verification
- command: `cargo test --manifest-path src-tauri/Cargo.toml`
- result: passed, `12 passed; 0 failed`.

## Completion
- status: done
- follow-up: if needed, move from `include_str!` to runtime SQL migration runner with version table (`schema_migrations`).
- [10:41:42] Synced completion summary into docs/development-progress.md (done)
